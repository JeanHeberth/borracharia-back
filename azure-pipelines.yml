trigger:
  - main

pool:
  name: agentPool   # usa o agente self-hosted MacM4-Agent

steps:
  # Checkout do reposit√≥rio
  - checkout: self

  # Configurar cache para Gradle (usa .gradle e build-cache)
  - task: Cache@2
    inputs:
      key: 'gradle | "$(Agent.OS)" | build.gradle'
      restoreKeys: |
        gradle | "$(Agent.OS)"
      path: ~/.gradle
    displayName: 'Cache Gradle dependencies'

  # Rodar build com Gradle Wrapper
  - task: Gradle@3
    inputs:
      gradleWrapperFile: 'gradlew'
      tasks: 'clean build'
      options: '-Xmx3072m'
      publishJUnitResults: true
      testResultsFiles: '**/TEST-*.xml'
      javaHomeOption: 'JDKVersion'
      jdkVersionOption: '1.17'       # Java 17
      jdkArchitectureOption: 'x64'

  # Publicar resultados de testes
  - task: PublishTestResults@2
    inputs:
      testResultsFiles: '**/TEST-*.xml'
      testRunTitle: 'JUnit Tests'
